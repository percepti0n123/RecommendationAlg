# markdown_report.py
import pandas as pd

def save_markdown_report(df: pd.DataFrame, path: str, student_id: int):
    """
    –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ –≤–∏–¥–µ markdown-–æ—Ç—á–µ—Ç–∞ —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º
    """
    with open(path, 'w', encoding='utf-8') as f:
        f.write(f"# üìò –û—Ç—á–µ—Ç –ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞ {student_id}\n\n")
        f.write("## üìå –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ\n")
        f.write("–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è:\n")
        f.write("- –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π —É—á–µ–Ω–∏–∫–∞ (–∞–Ω–∫–µ—Ç–∞)\n")
        f.write("- –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ —Ç–µ–º–∞–º (–µ—Å–ª–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å < 70%)\n")
        f.write("- –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–¥–∞–Ω–∏–π, —Ä–µ—à—ë–Ω–Ω—ã—Ö –ø–æ—Ö–æ–∂–∏–º–∏ —É—á–µ–Ω–∏–∫–∞–º–∏ (–∫–æ–ª–ª–∞–±–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä)\n\n")

        f.write("## üìä –°–ø–∏—Å–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π\n\n")
        f.write("| ID –∑–∞–¥–∞–Ω–∏—è | –¢–µ–º–∞ | –ü—Ä–∏—á–∏–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ | –ò—Å—Ç–æ—á–Ω–∏–∫ |\n")
        f.write("|------------|------|-----------------------|----------|\n")

        for _, row in df.iterrows():
            task_id = row.get("id", "")
            theme = row.get("theme_name", "")
            reason = row.get("explanation", "")
            source = row.get("source", "")
            f.write(f"| {task_id} | {theme} | {reason} | {source} |\n")

        f.write("\n_–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π._")

        print(f"üìÑ Markdown-–æ—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ {path}")

def save_readiness_report(df: pd.DataFrame, path: str, student_id: int):
    with open(path, 'w', encoding='utf-8') as f:
        f.write(f"# üß† –ê–Ω–∞–ª–∏–∑ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø–æ —Ç–µ–º–∞–º –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞ {student_id}\n\n")
        f.write("–û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–µ–π—Å—Ç–≤–∏—è–º:\n\n")
        f.write("| –¢–µ–º–∞ | –ü—Ä–æ–≥—Ä–µ—Å—Å (%) | –°–æ—Å—Ç–æ—è–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |\n")
        f.write("|------|----------------|------------|-----------------------------|\n")
        for _, row in df.iterrows():
            theme = row.get("theme_name", "")
            progress = row.get("progress", 0)
            state = row.get("—Å–æ—Å—Ç–æ—è–Ω–∏–µ", "")
            action = row.get("—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è", "")
            f.write(f"| {theme} | {progress:.1f} | {state} | {action} |\n")

        # –ò—Ç–æ–≥–æ–≤—ã–π –≤—ã–≤–æ–¥
        f.write("\n## üìå –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è\n")
        weak_themes = df[df["—Å–æ—Å—Ç–æ—è–Ω–∏–µ"] == "–Ω–µ –≥–æ—Ç–æ–≤"]["theme_name"].tolist()
        if weak_themes:
            f.write("–£—á–µ–Ω–∏–∫—É —Å—Ç–æ–∏—Ç —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö —Ç–µ–º–∞—Ö: \n")
            for t in weak_themes:
                f.write(f"- {t}\n")
        else:
            f.write("–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –£ —Å—Ç—É–¥–µ–Ω—Ç–∞ –Ω–µ—Ç —Ç–µ–º, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –æ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ –≥–æ—Ç–æ–≤. üéâ\n")

        f.write("\n_–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü—ã StudentThemeProgress._")

        print(f"üìÑ Markdown-–æ—Ç—á–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ {path}")